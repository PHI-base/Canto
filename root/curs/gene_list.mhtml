<%args>
$big_list => 0
$title => 'Genes'
</%args>

<div class="<% $class %>">
<form name="gene-edit" method="get" action="<% $edit_genes_path %>">
% if (@gene_hashes) {
  <table class="list">
%   if ($big_list) {
    <thead>
      <tr>
%     for my $col_name (@col_names) {
        <th>
          <% $col_name %>
        </th>
%     }
        <th>
          &nbsp;
        </th>
      </tr>
    </thead>
%   }

%   for my $gene (@gene_hashes) {
    <tr>
%     for my $col_name (@col_names) {
      <td>
        <% $gene->{$col_name} %>
      </td>
%     }
%     if ($big_list) {
      <td>
        <input type="checkbox"
               name="gene-select"
               value="<% $gene->{primary_identifier} %>" />
      </td>
%     }
    </tr>
%   }
  </table>
% } else {
  <div class="no-genes-message">
    [No genes]
  </div>
% }

%   if (!$big_list) {

  <div class="edit">
    <a href="./edit_genes">Edit ...</a>
  </div>

% }

  <input type="submit" name="submit" value="edit"/>

</form>
</div>

<%init>
use PomCur::Curs;

my $schema = PomCur::Curs::get_schema($c);
my @all_genes = $schema->resultset('Gene')->all();
my $class;
my @col_names;

my @gene_hashes = map {
     {
       primary_identifier => $_->primary_identifier(),
       primary_name => $_->primary_name(),
       product => $_->product(),
       identifier => $_->primary_name() || $_->primary_identifier(),
     }
   } @all_genes;

if ($big_list) {
  $class = 'big-gene-list';
  @col_names = qw(primary_identifier primary_name product);
} else {
  $class = 'small-gene-list';
  @col_names = qw(identifier);
}

my $edit_genes_path = $c->stash->{curs_root_path} . '/edit_genes';

</%init>
