<%args>
$schema
$title
$pub
$multi_organism_mode
$curs_root_uri
</%args>

<div>
<& allele_edit.mhtml,
   editing => 0,
   curs_root_uri => $curs_root_uri &>

<div ng-controller="MultiAlleleCtrl" id="curs-multi-allele-select"
     class="curs-box ng-cloak">
  <div ng-show="selectedGenes.length == 0">
    <div class="curs-box-title">
Choose the genes for this genotype
    </div>
    <div class="curs-box-body">
      <div class="row">
        <div class="col-sm-6 col-md-6">
          <table class="list">
            <thead>
              <tr>
                <th>Identifier</th>
                <th>Name</th>
                <th>&nbsp;</th>
              </tr>
            </thead>
            <tbody>
              <tr ng-repeat="gene in genes">
                <td>{{gene.primary_identifier}}</td>
                <td>{{gene.primary_name}}</td>
                <td><input type="checkbox" value="{{gene.selected}}" ng-model="gene.selected"></td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
      <button type="button" class="btn curs-finish-button"
              title="{{ 'Continue' }}"
              ng-disabled="currentlySelectedGenes() == 0"
              ng-click="selectGenes()">Continue</button>
      <div class="upload-genes-link">
        <a href="<% $upload_path %>">Add more genes from <% $pub->uniquename() %> ...</a>
      </div>
    </div>
  </div>

  <div ng-show="selectedGenes.length > 0">
    <div class="curs-box-title">
Add alleles from the genes below until the genotype is fully specified.
    </div>
    <div class="curs-box-body">

      <a title="Click to genotype edit name" href="#"
         editable-text="data.genotype_name">{{ data.genotype_name ? ('Name: ' + data.genotype_name) : "click to add genotype name" }}</a>

      <div class="row">
        <div class="col-sm-6 col-md-6">
          <table class="list">
            <thead>
              <tr>
                <th>Identifier</th>
                <th>Name</th>
                <th>&nbsp;</th>
              </tr>
            </thead>
            <tbody>
              <tr ng-repeat="gene in selectedGenes">
                <td>{{gene.primary_identifier}}</td>
                <td>{{gene.primary_name}}</td>
                <td>
                  <button class="btn btn-xs"
                          ng-click="openAlleleEditDialog(gene.primary_identifier, gene.primary_identifier, gene.gene_id)">Add allele ..</button>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
        <div class="col-sm-6 col-md-6">
          <div ng-show="alleles.length == 0">
[No alleles added yet]
          </div>

          <div id="multi-allele-genotype" class="ng-cloak" ng-show="alleles.length">

            <div>
The alleles for <b>{{ data.genotype_identifier }}</b>:
            </div>

            <table class="list">
              <thead>
                <tr>
                  <th>Name</th>
                  <th>Type</th>
                  <th>Description</th>
                  <th>Expression</th>
                </tr>
              </thead>
              <tbody ng-repeat="allele in alleles">
                <td>{{allele.name}}</td>
                <td>{{allele.type}}</td>
                <td>{{allele.description}}</td>
                <td>{{allele.expression}}</td>
                <td class="curs-table-row-remove">
                  <a href="#"> <span class="glyphicon glyphicon-remove" ng-click="removeAllele(allele)"></span></a>
                </td>
            </tbody>
            </table>
          </div>
        </div>
      </div>
      <button type="submit" class="btn btn-primary curs-back-button"
              title="Back to choose genes"
              ng-click="clearSelectedGene()" ng-disabled="false">Back</button>
      <button type="submit" class="btn btn-primary curs-finish-button"
              title="{{ isValid() ? '' : 'No alleles yet' }}"
              ng-click="storeAlleles()" ng-disabled="!isValid()">Finish</button>
      <button type="submit" class="btn btn-warning curs-finish-button"
              ng-click="cancel()">Cancel</button>
      
    </div>
  </div>
</div>

<%init>
use Canto::Curs;
use Canto::Track;
use Canto::Curs::GeneProxy;

my $config = $c->config();

if ($multi_organism_mode) {
  # ...
}

my $root_path = $c->stash()->{curs_root_path};
my $upload_path = $c->uri_for("$root_path/gene_upload",
                              { return_path => $c->req()->uri() });
</%init>
