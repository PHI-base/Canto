<%args>
$curs_root_uri
$annotation_type
@annotations
$completed_count
$gene
$pub
$user_created
</%args>

% if (@annotations) {
<div class="sect">
  <div class="title sect-title">
<% $title %>
  </div>
  <div class="annotation-table sect-content">
<table class="list">
  <thead>
    <tr>
% if (!defined $gene) {
      <th>
        Systematic identifier
      </th>
      <th>
        Gene name
      </th>
% }
      <th>
        Term ID
      </th>
      <th>
        Term name
      </th>
      <th>
        Evidence code
      </th>
      <th>
        With/from
      </th>
% if ($user_created) {
      <th>
        Note
      </th>
% if ($c->user_exists() && $c->user()->role()->name() eq 'admin') {
      <th>
        Annotation extension
      </th>
% }
      <th>
        &nbsp
      </th>
% }
    </tr>
  </thead>

% for my $row (@annotations) {
  <tr class="<% $row->{status} eq 'deleted' ? 'deleted-annotation' : '' %>">
% if (!defined $gene) {
    <td>
      <span>
      <% $row->{gene_identifier} %>
      </span>
    </td>
    <td>
      <span>
      <% $row->{gene_name} %>
      </span>
    </td>
% }
    <td>
      <span>
      <% $row->{term_ontid} %>
      </span>
    </td>
    <td>
      <span>
      <% $row->{term_name} %>
      </span>
    </td>
    <td>
      <span>
% if (defined $row->{evidence_code}) {
     <% $row->{evidence_code} %>
% } else {
     <a href="<% $curs_root_uri . '/annotation/evidence/' . $row->{annotation_id} %>">Set evidence ...</a>
% }
      </span>
    </td>
    <td>
      <span>
% if ($row->{needs_with} || defined $row->{with_or_from_display_name}) {
%   if (defined $row->{with_or_from_display_name}) {
      <% $row->{with_or_from_display_name} %>
%   } else {
      <a href="<% $curs_root_uri . '/annotation/with_gene/' . $row->{annotation_id} %>">Set with/from ...</a>
%   }
% } else {
     &nbsp; 
% }
      </span>
    </td>
% if ($user_created) {
    <td>
      <span>
%   if ($row->{term_suggestion}) {
      <a href="#" onclick="javascript:curs_home.show_term_suggestion('<% $row->{term_ontid} %>','<% $row->{term_suggestion}->{name} %>','<% $row->{term_suggestion}->{definition} %>');">View note ...</a>
%   } else {
      &nbsp;
% }
      </span>
    </td>
% if ($c->user_exists() && $c->user()->role()->name() eq 'admin') {
    <td>
      <span>
%   if ($row->{annotation_extension}) {
      <a href="<% $curs_root_uri . '/annotation/transfer/' . $row->{annotation_id} %>"><% $row->{annotation_extension} %></a>
%   } else {
      <a href="<% $curs_root_uri . '/annotation/transfer/' . $row->{annotation_id} %>">Add extension ...</a>
%   }
      </span>
    </td>
% }
    <td>
% if ($row->{status} eq 'deleted') {
      <a href="<% $undelete_action . $row->{annotation_id} %>"
         id="curs-annotation-undelete-<% $row->{annotation_id} %>"
         title="Restore/undelete this annotation">
        <img src="<% $undelete_icon_uri %>"/>
      </a>
% } else {
      <a href="<% $delete_action . $row->{annotation_id} %>"
         id="curs-annotation-delete-<% $row->{annotation_id} %>"
         title="Remove this annotation">
        <img src="<% $delete_icon_uri %>"/>
      </a>
% }
    </td>
% }
  </tr>
% }
</table>
% if ($some_incomplete && !$gene) {
<div class="curs-annotation-incomplete-message">
  Note that some of the annotations are incomplete, and only complete
  annotations are included in the downloaded table.
</div>
% }
</div>
</div>
% }

<%init>
my $delete_action = $curs_root_uri . '/annotation/delete/';
my $delete_icon_uri = $c->uri_for('/static/images/delete_icon.png');
my $undelete_action = $curs_root_uri . '/annotation/undelete/';
my $undelete_icon_uri = $c->uri_for('/static/images/undo_icon.png');

my $some_incomplete = $completed_count != @annotations && $user_created;

my $gene_text = "";
if (defined $gene) {
  $gene_text = ' for ' . $gene->display_name();
}

my $new_or_db;
if ($user_created) {
  $new_or_db = 'New ';
} else {
  $new_or_db = 'Existing ';
}

my $title = $new_or_db . $annotation_type->{display_name} . ' annotations ' .
  $gene_text . ($user_created ? '' : ' from ' . $pub->uniquename());
</%init>
