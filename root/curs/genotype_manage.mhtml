<%args>
$curs_root_uri
$pub
$read_only_curs => 0
</%args>

<div ng-controller="GenotypeManageCtrl"
     id="curs-genotype-manage" class="genotype-list curs-box">
  <div ng-hide="data.genotypeSearching">
    <div class="curs-box-title">
      <div>
Genotype list
      </div>
    </div>
    <div class="curs-box-body">
      <div ng-show="data.genotypes">
        <div class="curs-genotype-list-instructions">
Genotypes used in this curation session:
        </div>

        <genotype-list-view genotype-list="data.genotypes"></genotype-list-view>
      </div>
      <div class="ng-cloak" ng-hide="data.genotypes">
No genotypes in this session, try 
<a href="<% $start_path . '/feature/genotype/add' %>">adding one</a>.

      </div>

      <div>
Actions:
      </div>
      <div class="feature-list-action">
        <a ng-click="startSearch()" href="#">Find an existing genotype ...</a>
      </div>
      <div class="feature-list-action">
        <a href="<% $start_path . '/feature/genotype/add' %>">Add a genotype ...</a>
      </div>
    </div>

  </div>  
  <div ng-show="data.genotypeSearching">
    <div class="curs-box-title">
Search
    </div>
    <div class="curs-box-body">
    </div>
  </div>

</div>


<%init>
use Canto::Curs;

my $schema = $c->stash()->{schema};
my $config = $c->config();

my @all_genotypes = $schema->resultset('Genotype')->all();

my @genotype_hashes = map {
  my @annotations = $_->annotations();
  my $annotation_count = scalar(@annotations);
  {
    identifier => $_->identifier(),
    display_name => $_->display_name(),
    name => $_->name(),
    genotype_id => $_->genotype_id(),
    allele_string => $_->allele_string(),
    annotation_count => $annotation_count,
  }
} @all_genotypes;

my $start_path = $c->stash()->{curs_root_uri};
</%init>
</div>
