<%args>
$object
$class_info
$schema
</%args>

<&| /view/object/object_top.mhtml, object => $object, class_info => $class_info &>

% if (!defined $object->assigned_curator()) {
<div id="curs-pub-assign-dialog" style="display: none">
  <form id="ferret-suggest-form" method="put" action="/track/assign_pub">
    <input type="hidden" name="pub-id" value="<% $object->pub_id() %>"/>
    <input type="hidden" name="pub-view-path" value="<% $current_pathquery %>"/>

    <select name="pub-assign-person">
% for my $person_data (@people_data) {
      <option value="<% $person_data->{id} %>"><% $person_data->{text} %></option>
% }
    </select>

    <div id="curs-pub-assign-help" class="ferret-help-text">
      Choose a curator to assign this publication to.  A session will
      then be automatically created for the publication.
    </div>
    <input id="curs-pub-assign-cancel" name="curs-pub-assign-cancel" type="submit"
           value="Cancel" class="button"/>
    <input name="curs-pub-assign-submit" type="submit"
           value="Assign" class="button"/>
  </form>
</div>

<div class="curs-pub-assign-actions">
  <button id="curs-pub-assign-popup-dialog"><% $assign_to_text %></button>
</div>
% }

<div class="sect abstract">
<span class="sect-title disclosed-title"><a href="#"> Abstract </a> </span>
<div class="sect-content">
  <% $abstract %>
</div>
</div>

</&>

<div id="collections">
  <& /view/collection.mhtml, object => $object, collection_name => 'curs',
     collection_title => "Curation sessions" &>
  <& /view/collection.mhtml, object => $object,
    collection_name => 'pub_curation_statuses',
    collection_title => 'Status for all curation types' &>
  <& /view/collection.mhtml, object => $object,
    collection_name => 'pubprops',
    collection_title => 'Publication properties' &>
</div>

<%init>
use PomCur::Curs;

my $abstract = $object->abstract() // '[Abstract not available]';
my $current_pathquery = $c->req->uri()->path_query();
my $person_rs = $schema->resultset('Person');

my @people_data = ();

while (defined (my $person = $person_rs->next())) {
  push @people_data, { id => $person->person_id(),
                       text => $person->name() . ' <' . $person->email_address() . '>' };
}

my $assign_to_text;

#if (defined $object->assigned_curator()) {
#  $assign_to_text = 'Change curator ...';
#} else {
  $assign_to_text = 'Assign to curator ...';
#}
</%init>
