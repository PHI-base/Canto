<%args>
$pub
</%args>

<div class="triage">
  <form id="triage-form" action="" method="get">
    <input type="hidden" id="triage-pub-id" name="triage-pub-id"
           value="<% $pub->pub_id() %>"/>
    <div class="pub-details">
      <div class="sect title">
        <span class="sect-title">
          Title
        </span>
        <div class="sect-content">
          <% $pub->title() %>
        </div>
      </div>
      <div class="sect authors">
        <span class="sect-title">
          Authors
        </span>
        <div class="sect-content">
          <% $pub->authors() %>
        </div>
      </div>
      <div class="sect abstract">
        <span class="sect-title undisclosed-title">
          <a href="#">Abstract</a>
        </span>
        <div class="sect-content" style="display: none">
          <% $pub->abstract() %>
        </div>
      </div>
% for my $experiment_type (@experiment_types) {
      <div>
        <input type="checkbox" name="experiment-type"
               value="<% $experiment_type %>" ><% $experiment_type %><br>
      </div>
% }
    </div>
    <div class="status-settings">
      <div class="sect status-choice">
        <span class="sect-title">
          <a href="#">Actions ...</a>
        </span>
        <div class="sect-content">
          <ul>
% for my $status_info (@status_links) {
            <li>
              <input type="submit" name="submit"
              value="<% $status_info->{name} %>">
            </li>
% }
          </ul>
        </div>
      </div>
    </div>

  </form>
  <div class="clearall"/>

</div>


<%init>
my $schema = $c->schema('track');
my $status_cv_name = 'PomCur publication triage status';
my $status_cv = $schema->find_with_type('Cv', { name => $status_cv_name });

my @status_links = ();

my @pub_statuses =
  $schema->resultset('Cvterm')->search({ cv_id => $status_cv->cv_id() });

for my $status (@pub_statuses) {
  my $name = $status->name();

  if ($name eq 'New') {
    next;
  }

  my $status_id = $status->cvterm_id();
  my $path = '/tools/triage/' . $pub->pub_id() .
    '/status/' . $status_id;
  my $link = $c->uri_for($path);

  push @status_links, { name => $name,
                        link => $link };
}

my $experiment_type_cv_name = 'PomCur publication experiment types';
my $experiment_type_cv =
  $schema->find_with_type('Cv', { name => $experiment_type_cv_name });

my @experiment_type_cvterms =
  $schema->resultset('Cvterm')->search({ cv_id => $experiment_type_cv->cv_id() });

my @experiment_types = map { $_->name() } @experiment_type_cvterms;

</%init>
